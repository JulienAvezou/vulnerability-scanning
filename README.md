# vulnerability-scanning
Notes from DevSecOps ch.3 Security Essentials

Create and configure a gitlab ci file that will take care of setting up an automated pipeline to run some tests and then build a docker image to push to docker hub

<img width="788" alt="Capture d’écran 2024-05-12 à 20 13 52" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/de8ce9b9-68be-4ab2-a1b8-97876cc15ea7">
<img width="1169" alt="Capture d’écran 2024-05-12 à 20 12 58" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/b35bf9a1-dce7-4bac-b657-38f6b7acdb49">
<img width="1261" alt="Capture d’écran 2024-05-12 à 20 12 51" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/19f214c7-dacc-40f3-a72a-f3289b915936">

We can optimise the file by implementing caching to reduce subsequent pipeline runs

<img width="457" alt="Capture d’écran 2024-05-12 à 20 19 58" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/5204dff4-01de-483b-b4fe-7ec1c55f2828">

However at this point, we have no secure insights from our pipeline

### Security in context of devops: ongoing and integral part of entire software development lifecycle
Knowing which tools to use when automating is key
Making pipelines transferable is also important (don't make your CI platform specific)
Shift security as early as possible in software development lifecycle 

An example of a security check is to prevent secrets in git repos
Can use the tool **GitLeaks**
Running the detect cmd outputs the number of leaks (more info with --verbose flag)

<img width="480" alt="Capture d’écran 2024-05-12 à 21 48 44" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/56092fbd-4cd9-4879-8819-69be5e8c6f78">
<img width="487" alt="Capture d’écran 2024-05-12 à 21 54 42" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/2a163ae8-049a-40f2-b963-0dcc82b88d98">

Now we can add Gitleaks as part of the pipeline jobs

<img width="355" alt="Capture d’écran 2024-05-13 à 19 38 37" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/ea10369d-1de5-439e-96b6-27a54851a049">
<img width="862" alt="Capture d’écran 2024-05-13 à 19 54 43" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/805d13b3-3631-4e49-80c7-c1d7734a6681">

Better to run Gitleaks as a Pre-Commit hook to avoid pushing code with any secrets being leaked in the repository:
- create pre-commit file in git hooks directory and add Gitleaks cmd to the pre-commit file

<img width="816" alt="Capture d’écran 2024-05-13 à 19 47 00" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/2bbb82e7-ceb1-4c0f-af25-8aa52f95dbfc">

- make the file executable

<img width="553" alt="Capture d’écran 2024-05-13 à 19 48 08" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/2b5be43f-fefd-492b-96b7-2087c6492470">

- could also add server-side hook too as improvement (ie. pre-receive hook)

Important to train tools to reduce false positives (flagged issue but not really an issue that should be blocking the pipeline)
To handle false positives:
  1. don't fail the build - get insight about state of application security as a first step
    - allow_failure flag in Gitlab pipeline
     
<img width="323" alt="Capture d’écran 2024-05-13 à 19 58 09" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/296a75da-0430-4fbc-b268-141f8f0bd310">
<img width="748" alt="Capture d’écran 2024-05-13 à 20 04 54" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/316a19c8-aaf0-4598-bb56-2b770b61afc0">

  2. adjust the tool config until it can handle the false positives correctly
    - exclude test files from scanning to remove many false positives
     <img width="564" alt="Capture d’écran 2024-05-13 à 20 04 21" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/95d51218-af39-4c09-9cb3-53b3fe4573a8">
    - add hard-coded secrets in pipeline as secret variables within Gitlab settings
     <img width="1035" alt="Capture d’écran 2024-05-13 à 20 15 45" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/fb91ea45-c147-4365-8c4a-b06eea36b8a3">
     <img width="239" alt="Capture d’écran 2024-05-13 à 20 16 57" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/b07b9344-e3b1-469b-a304-ffbb5950e676">

  3. add strict permissions on git repositories, handle proper access management

### SAST - Static Application Security Testing

different SAT tools based on programming lang
- goal is to gradually reduce security findings over time
- teach teams to write secure code, configure app securely
eg. njsscan for node.js SAST scans

Let's add njsscan as part of the pipeline and examine findings

<img width="313" alt="Capture d’écran 2024-05-13 à 20 40 33" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/bb01f871-6e2a-44af-aec7-7f34c7029827">
<img width="827" alt="Capture d’écran 2024-05-13 à 20 46 54" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/6f203459-9d70-45e5-8ef9-110845f7d4da">

It's best practice to use a mix of tools for synergies and full coverage of security scanning
So let's now also add Semgrep scanning as part of the pipeline

<img width="288" alt="Capture d’écran 2024-05-13 à 20 53 11" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/b6eda1c6-1dac-4211-91d7-33dbb41d57bf">
<img width="775" alt="Capture d’écran 2024-05-13 à 21 08 13" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/3c5593e3-d8b7-427f-a468-2ece9aa8efb3">
<img width="825" alt="Capture d’écran 2024-05-13 à 21 08 44" src="https://github.com/JulienAvezou/vulnerability-scanning/assets/62488871/87cb9c09-ddb5-4817-82df-9eb6eef82b87">



     



